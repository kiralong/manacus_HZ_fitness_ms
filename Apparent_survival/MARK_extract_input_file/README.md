# Extract Mark Recapture Input File

Extract *Mark Recapture* data from manakin capture data into a year-by-year Mark Recapture matrix for each bird
for use as an input file for Program Mark.

Notes:

- "Mark Recapture" is the name of the method. [Program MARK](http://www.phidot.org/software/mark/) uses mark recpature data, and has specific input file format, which this script formats raw data into such specific file format for Program MARK to process.

## Input

Takes as input a TSV that has at least these columns with these exact names, case-sensitive. Additional columns will be ignored from this original data (as they are not relevant), and columns may be in any order, interspersed, etc.

<!-- markdownlint-disable MD010 -->
```tsv
Date	Population	Band #
2/20/17	8	1
```
<!-- markdownlint-enable MD010 -->

## Output

Outputs a file in the form of [example_input_file_ed_males.inp](./example_input_file_ed_males.inp) which is compatible with Program MARK.

<!-- markdownlint-disable MD010 -->
```tsv
/* manakins -- 4 sampling occasions -- 3 groups */
/* band_number */  1010  1  0  0
/* band_number */  0001  0  1  0
```
<!-- markdownlint-enable MD010 -->

- The first row is occupied by a metadata comment.
- There are no headings.
- Columns are separated by 2 spaces.
- The 1st column `band_number` is the unique ID of the bird (and is the number on the birds aluminum band). This column is wrapped in the MARK comment format.
- The 2nd column is the "smooshed together" data of the capture record. It should have no spaces in between each capture record. 1 means the bird was captured/seen and 0 means the bird was not captured/seen in that time period. In this case, it is per year so 1010 means the bird was seen in years 1 and 3 but not years 2 and 4.
- The 3rd, 4th, and 5th columns are, when considered all together, a bitwise flag to indicate the Can/Hyb/Vit (candei/hybrid/vitellinus) options of the manakin raw data sheet's species categories (column 6 in the original data).

## Installation

Install the version of Python in `.tool-versions`. This should also install `pip`.

- The easiest way to do this is with [`asdf`](https://asdf-vm.com). Install `asdf` and then run the following in this directory, which installs all tools in `.tool-versions`:

  ```shell
  asdf install
  ```

Dependencies are managed using `pipenv`. Install `pipenv` by running:

```shell
pip install pipenv
```

- NOTE: If using `asdf`, you need to *reshim* the Python installation every time you use the existing Python shims to install a new executable. So for example, `pipenv` is a new executable you can call straight from the command line and you installed it with `pip` which is an `asdf` shim, so after installing `pipenv`, run the following, which will shim `pipenv` allowing it to be run.

  ```shell
  asdf reshim python
  ```

Now that we have `pipenv`, run the following to install all dependencies described in the `Pipfile`:

```shell
pipenv install
```

## Development + Building

The Jupyter notebook is the source of truth.

```shell
pipenv run jupyter notebook
```

The python script version is automatically generated by running the following command in the terminal:

```shell
pipenv run jupyter nbconvert extract_bird_mark_recapture_matrix.ipynb --to python
```

Regenerate and commit the Python script whenever you change the notebook.

## Usage

Open a Jupyter Notebook:

```shell
pipenv run jupyter notebook
pipenv run jupyter notebook extract_bird_mark_recapture_matrix.ipynb
```

After using `nbconvert` (see [Development + Building](#development--building)), run the python script

Run the python script directly:

```shell
pipenv run python extract_bird_mark_recapture_matrix.py
```

You may want to comment out the print statements in the python script; the notebook prints generously, but all that junk will clog up CLI output.

## Authors

George W. Pantazes & Kira M. Long
